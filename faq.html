<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Q&A ボックス付きページ</title>
  <style>
    :root{--bg:#f7fafc;--card:#ffffff;--accent:#ef4444;--muted:#6b7280}
    body{font-family: "Noto Sans JP", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); margin:24px}
    .container{max-width:840px;margin:0 auto}
    header h1{margin:0 0 8px;font-size:1.6rem}
    header p{margin:0 0 20px;color:var(--muted)}

    /* Q&A card */
    .qa-card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(15,23,42,0.06)}
    .qa-list{margin:0;padding:0;list-style:none}
    .qa-item{border-top:1px solid #eef2f7;padding:12px 0}
    .qa-item:first-child{border-top:0}
    .question{display:flex;align-items:center;justify-content:space-between;cursor:pointer}
    .question b{font-weight:700}
    .meta{font-size:0.85rem;color:var(--muted)}
    .answer{margin-top:10px;display:none;color:#111827;line-height:1.6}
    .qa-item.open .answer{display:block}
    .controls{display:flex;gap:6px;align-items:center}
    .toggle,.delete{background:none;border:0;font-size:1.15rem;cursor:pointer}
    .delete{color:var(--accent)}

    /* form */
    .add-form{margin-top:18px;display:grid;gap:8px}
    .add-form input,.add-form textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6edf3;font-size:0.95rem}
    .row{display:flex;gap:8px}
    .btn{padding:10px 14px;border-radius:8px;border:0;cursor:pointer}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-ghost{background:transparent;border:1px solid #e6edf3}

    /* small screens */
    @media (max-width:520px){body{margin:12px} .container{padding:0 6px}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>トマト</h1>
      <p>Q&Aを追加して知識を共有しましょう</p>
    </header>

    <section class="qa-card" aria-labelledby="qa-heading">
      <h2 id="qa-heading" style="margin-top:0;">Q&amp;A</h2>

      <ul class="qa-list" id="qaList">
        <!-- サンプルのQ&AはJavaScriptでローカルストレージから読み込まれます -->
      </ul>

      <form id="addForm" class="add-form" onsubmit="return false;">
        <input id="qInput" type="text" placeholder="質問を入力してください（必須）" required />
        <textarea id="aInput" rows="3" placeholder="回答を入力してください（必須）" required></textarea>
        <div class="row">
          <button id="addBtn" class="btn btn-primary">追加</button>
          <button id="clearBtn" class="btn btn-ghost" type="button">入力をクリア</button>
        </div>
      </form>
    </section>
  </div>

  <script>
    (function(){
      const qaList = document.getElementById('qaList');
      const addBtn = document.getElementById('addBtn');
      const clearBtn = document.getElementById('clearBtn');
      const qInput = document.getElementById('qInput');
      const aInput = document.getElementById('aInput');

      // ローカルストレージからQ&Aを読み込む
      function loadQAItems() {
        const savedItems = localStorage.getItem('qaItems');
        if (savedItems) {
          const items = JSON.parse(savedItems);
          items.forEach(item => {
            addQAItemToDOM(item, false);
          });
        } else {
          // 初回アクセス時はサンプルを表示
          addQAItemToDOM({
            id: 'sample-1',
            question: 'サンプルの質問ですか？',
            answer: 'はい、これはサンプルの回答です。クリックでトグルします。',
            author: '管理者',
            date: '2025-09-10'
          }, false);
        }
      }

      // Q&AアイテムをDOMに追加
      function addQAItemToDOM(item, saveToStorage = true) {
        const li = document.createElement('li');
        li.className = 'qa-item';
        li.setAttribute('data-id', item.id);
        li.innerHTML = `
          <div class="question" tabindex="0">
            <div>
              <b>Q. ${escapeHtml(item.question)}</b>
              <div class="meta">投稿者: ${escapeHtml(item.author)} · ${item.date}</div>
            </div>
            <div class="controls">
              <button class="toggle" aria-expanded="false" aria-controls="answer-${item.id}">＋</button>
              <button class="delete" title="削除">🗑</button>
            </div>
          </div>
          <div class="answer" id="answer-${item.id}">${escapeHtml(item.answer)}</div>
        `;
        qaList.insertBefore(li, qaList.firstChild);
        
        if (saveToStorage) {
          saveQAItemsToStorage();
        }
      }

      // Q&Aアイテムをローカルストレージに保存
      function saveQAItemsToStorage() {
        const items = [];
        document.querySelectorAll('.qa-item').forEach(item => {
          // サンプルデータは保存しない
          if (item.getAttribute('data-id').startsWith('sample-')) return;
          
          items.push({
            id: item.getAttribute('data-id'),
            question: item.querySelector('.question b').textContent.replace('Q. ', ''),
            answer: item.querySelector('.answer').textContent,
            author: item.querySelector('.meta').textContent.split('投稿者: ')[1].split(' · ')[0],
            date: item.querySelector('.meta').textContent.split(' · ')[1]
          });
        });
        localStorage.setItem('qaItems', JSON.stringify(items));
      }

      // トグル・削除機能（イベントデリゲーション）
      qaList.addEventListener('click', function(e){
        const toggle = e.target.closest('.toggle');
        const del = e.target.closest('.delete');

        if(toggle){
          const item = toggle.closest('.qa-item');
          const expanded = toggle.getAttribute('aria-expanded') === 'true';
          toggle.setAttribute('aria-expanded', String(!expanded));
          toggle.textContent = expanded ? '＋' : '−';
          item.classList.toggle('open');
          return;
        }

        if(del){
          const item = del.closest('.qa-item');
          if(confirm('この質問を削除しますか？')){
            item.remove();
            saveQAItemsToStorage();
          }
        }
      });

      // キーボードでも開閉できるようにする
      qaList.addEventListener('keydown', function(e){
        if(e.key === 'Enter' || e.key === ' ') {
          const q = e.target.closest('.question');
          if(q){
            e.preventDefault();
            q.querySelector('.toggle').click();
          }
        }
      });

      // 追加ボタン
      addBtn.addEventListener('click', function(){
        const qText = qInput.value.trim();
        const aText = aInput.value.trim();
        if(!qText || !aText) return alert('質問と回答の両方を入力してください。');

        const id = 'item-' + Date.now();
        const newItem = {
          id: id,
          question: qText,
          answer: aText,
          author: 'あなた',
          date: new Date().toLocaleDateString()
        };
        
        addQAItemToDOM(newItem);
        qInput.value = '';
        aInput.value = '';
        qInput.focus();
      });

      clearBtn.addEventListener('click', function(){ 
        qInput.value=''; 
        aInput.value=''; 
        qInput.focus(); 
      });

      // シンプルなエスケープ
      function escapeHtml(text){
        return text.replace(/[&<>"']/g, function(m){
          return ({
            '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"
          })[m];
        });
      }

      // 初期フォーカス
      qInput.placeholder = '質問例: このサイトはどのように使いますか？';
      
      // ページ読み込み時にQ&Aを読み込む
      document.addEventListener('DOMContentLoaded', loadQAItems);

    })();
  </script>
</body>
</html>
