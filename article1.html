<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>総当たり戦結果</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
      font-size: 2em;
    }
    .section { margin-bottom: 40px; }
    .section h2 {
      background-color: #4CAF50;
      color: white;
      padding: 10px;
      margin: 0 0 15px 0;
      border-radius: 5px;
    }
    table {
      border-collapse: collapse;
      margin: 10px 0;
      width: 100%;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
      cursor: pointer;
    }
    th {
      background-color: #f2f2f2;
      font-weight: bold;
    }
    .match-table th, .match-table td:first-child {
      background-color: #e8f5e8;
      font-weight: bold;
    }
    .results-grid th:first-child, .results-grid td:first-child {
      background-color: #f2f2f2;
      cursor: default;
    }
    .gray { background-color: #d3d3d3 !important; cursor: default; }
    .lightblue { background-color: #add8e6 !important; }
    .red { background-color: #ff6347 !important; }
    .yellow { background-color: #ffff99 !important; }
    .orange { background-color: #ffa500 !important; }
    .green { background-color: #90ee90 !important; }

    .participant-list {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .participant-box {
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 5px;
      text-align: center;
      font-weight: bold;
      min-width: 100px;
    }
    .participant-box.royal { background-color: #add8e6; }
    .participant-box.nightmare { background-color: #ffff00; }
    .participant-box.highlander { background-color: #ffa500; }
    .participant-box.witch { background-color: #ade6b2; }
    .participant-box.bishop { background-color: #ff6347; }

    .note {
      margin-top: 20px;
      padding: 10px;
      background-color: #e0f2f1;
      border-left: 5px solid #009688;
    }

    /* 対戦カードだけグレーアウト */
    .finished-card {
      background-color: #eee !important;
      color: #888;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🎮 総当たり戦結果</h1>

    <div class="section">
      <h2>👥 参加者とキャラクター</h2>
      <div class="participant-list">
        <div class="participant-box royal"><p><strong>1: S.K</strong></p><p>ロイヤル</p></div>
        <div class="participant-box nightmare"><p><strong>2: H.K</strong></p><p>ナイトメア</p></div>
        <div class="participant-box highlander"><p><strong>3: S.R</strong></p><p>ハイランダー</p></div>
        <div class="participant-box witch"><p><strong>4: S.N</strong></p><p>ウィッチ</p></div>
        <div class="participant-box bishop"><p><strong>5: N.T</strong></p><p>ビショップ</p></div>
      </div>
    </div>

    <div class="section">
      <h2>🏆 対戦表</h2>
      <table class="match-table" id="matchTable">
        <thead><tr><th>試合番号</th><th>対戦カード</th></tr></thead>
        <tbody>
          <tr><td>第1試合</td><td>2 vs 5</td></tr>
          <tr><td>第2試合</td><td>3 vs 4</td></tr>
          <tr><td>第3試合</td><td>1 vs 5</td></tr>
          <tr><td>第4試合</td><td>2 vs 3</td></tr>
          <tr><td>第5試合</td><td>1 vs 4</td></tr>
          <tr><td>第6試合</td><td>5 vs 2</td></tr>
          <tr><td>第7試合</td><td>1 vs 3</td></tr>
          <tr><td>第8試合</td><td>4 vs 2</td></tr>
          <tr><td>第9試合</td><td>1 vs 2</td></tr>
          <tr><td>第10試合</td><td>4 vs 5</td></tr>
        </tbody>
      </table>
    </div>

    <div class="section">
      <h2>📝 結果グリッド</h2>
      <table class="results-grid" id="resultsGrid">
        <thead>
          <tr><th></th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th></tr>
        </thead>
        <tbody>
          <tr><th>1</th><td class="gray"></td><td></td><td></td><td></td><td></td></tr>
          <tr><th>2</th><td></td><td class="gray"></td><td></td><td></td><td></td></tr>
          <tr><th>3</th><td></td><td></td><td class="gray"></td><td></td><td></td></tr>
          <tr><th>4</th><td></td><td></td><td></td><td class="gray"></td><td></td></tr>
          <tr><th>5</th><td></td><td></td><td></td><td></td><td class="gray"></td></tr>
        </tbody>
      </table>
      <div class="note">
        <p><strong>凡例:</strong></p>
        <ul>
          <li>セルをクリック → 「〇 → × → 空白」で切替</li>
          <li>背景色は相手キャラ色に対応</li>
          <li>終わった試合は対戦表が自動でグレーアウト</li>
          <li>勝利数ランキングも下に自動表示</li>
        </ul>
      </div>
    </div>

    <div class="section">
      <h2>🥇 勝利数ランキング</h2>
      <table id="rankingTable">
        <thead>
          <tr><th>順位</th><th>参加者</th><th>キャラクター</th><th>勝利数</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div style="text-align: center; margin-top: 30px; color: #666; border-top: 1px solid #ddd; padding-top: 20px;">
      <p>最終更新: 2025年9月10日</p>
    </div>
  </div>

  <script>
    // キャラクターごとの色マップ
    const colors = {
      1: "lightblue",  // ロイヤル
      2: "yellow",     // ナイトメア
      3: "orange",     // ハイランダー
      4: "green",      // ウィッチ
      5: "red"         // ビショップ
    };

    // プレイヤー情報
    const players = {
      1: { name: "S.K", char: "ロイヤル" },
      2: { name: "H.K", char: "ナイトメア" },
      3: { name: "S.R", char: "ハイランダー" },
      4: { name: "S.N", char: "ウィッチ" },
      5: { name: "N.T", char: "ビショップ" }
    };

    // 対戦表更新
    function updateFinishedMatches() {
      const results = document.querySelectorAll("#resultsGrid tbody tr");
      const matchRows = document.querySelectorAll("#matchTable tbody tr");

      matchRows.forEach(row => {
        const matchText = row.cells[1].textContent.trim();
        const [p1, p2] = matchText.split(" vs ").map(Number);

        let cell1 = results[p1 - 1].querySelectorAll("td")[p2 - 1];
        let cell2 = results[p2 - 1].querySelectorAll("td")[p1 - 1];

        if ((cell1 && (cell1.textContent === "〇" || cell1.textContent === "×")) ||
            (cell2 && (cell2.textContent === "〇" || cell2.textContent === "×"))) {
          row.cells[1].classList.add("finished-card");
        } else {
          row.cells[1].classList.remove("finished-card");
        }
      });
    }

    // 勝利数ランキング更新
    function updateRanking() {
      const grid = document.getElementById("resultsGrid");
      const rows = grid.querySelectorAll("tbody tr");

      // 勝利数カウント
      let wins = {1:0,2:0,3:0,4:0,5:0};
      rows.forEach((row, i) => {
        const player = i + 1;
        row.querySelectorAll("td").forEach((cell, j) => {
          if (player === j+1) return;
          if (cell.textContent === "〇") {
            wins[player]++;
          }
        });
      });

      // ソート（勝利数降順）
      let ranking = Object.entries(wins).sort((a,b) => b[1] - a[1]);

      const tbody = document.querySelector("#rankingTable tbody");
      tbody.innerHTML = "";
      let lastWins = null, rank = 0, displayRank = 0;
      ranking.forEach(([player, win]) => {
        rank++;
        if (win !== lastWins) {
          displayRank = rank;
        }
        lastWins = win;

        let tr = document.createElement("tr");
        tr.innerHTML = `<td>${displayRank}</td>
                        <td>${players[player].name}</td>
                        <td>${players[player].char}</td>
                        <td>${win}</td>`;
        tbody.appendChild(tr);
      });
    }

    function setupGrid() {
      const grid = document.getElementById("resultsGrid");
      grid.querySelectorAll("tbody tr").forEach((row, i) => {
        const rowPlayer = i + 1;
        row.querySelectorAll("td").forEach((cell, j) => {
          const colPlayer = j + 1;
          if (rowPlayer === colPlayer) return; // 自分対自分はスキップ

          cell.addEventListener("click", () => {
            // 勝敗を切替
            if (cell.textContent === "") {
              cell.textContent = "〇";
            } else if (cell.textContent === "〇") {
              cell.textContent = "×";
            } else {
              cell.textContent = "";
            }

            // 背景色リセット
            cell.className = "";
            if (cell.textContent !== "") {
              cell.classList.add(colors[colPlayer]);
            }

            updateFinishedMatches();
            updateRanking();
          });
        });
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      setupGrid();
      updateFinishedMatches();
      updateRanking();
    });
  </script>
</body>
</html>
